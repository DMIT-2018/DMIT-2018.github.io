<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seating Reservations | DMIT-2018 Student Notes</title>
    <meta name="description" content="Intermediate Application Development">
    
    
    <link rel="preload" href="/assets/css/0.styles.912ec5d4.css" as="style"><link rel="preload" href="/assets/js/app.df72257b.js" as="script"><link rel="preload" href="/assets/js/50.d0852263.js" as="script"><link rel="prefetch" href="/assets/js/1.126b5e27.js"><link rel="prefetch" href="/assets/js/2.5ff883b1.js"><link rel="prefetch" href="/assets/js/3.9da7b2bd.js"><link rel="prefetch" href="/assets/js/4.8ec49770.js"><link rel="prefetch" href="/assets/js/5.31815e4f.js"><link rel="prefetch" href="/assets/js/6.7df3e91c.js"><link rel="prefetch" href="/assets/js/7.3004d89b.js"><link rel="prefetch" href="/assets/js/8.bd4672c3.js"><link rel="prefetch" href="/assets/js/9.805e4d06.js"><link rel="prefetch" href="/assets/js/10.56738c6c.js"><link rel="prefetch" href="/assets/js/11.cae046a1.js"><link rel="prefetch" href="/assets/js/12.e22b84dc.js"><link rel="prefetch" href="/assets/js/13.d2ab5cbf.js"><link rel="prefetch" href="/assets/js/14.99c1f55d.js"><link rel="prefetch" href="/assets/js/15.42860b96.js"><link rel="prefetch" href="/assets/js/16.43ecabce.js"><link rel="prefetch" href="/assets/js/17.29de6b09.js"><link rel="prefetch" href="/assets/js/18.5379304f.js"><link rel="prefetch" href="/assets/js/19.07259a9b.js"><link rel="prefetch" href="/assets/js/20.6e07931f.js"><link rel="prefetch" href="/assets/js/21.d0032c16.js"><link rel="prefetch" href="/assets/js/22.23bc3303.js"><link rel="prefetch" href="/assets/js/23.4b1c6e9d.js"><link rel="prefetch" href="/assets/js/24.b949edf3.js"><link rel="prefetch" href="/assets/js/25.6aec8acf.js"><link rel="prefetch" href="/assets/js/26.f89ea306.js"><link rel="prefetch" href="/assets/js/27.f8696b20.js"><link rel="prefetch" href="/assets/js/28.97bf0d58.js"><link rel="prefetch" href="/assets/js/29.fe1435ed.js"><link rel="prefetch" href="/assets/js/30.11645455.js"><link rel="prefetch" href="/assets/js/31.9b1e7710.js"><link rel="prefetch" href="/assets/js/32.e94594b7.js"><link rel="prefetch" href="/assets/js/33.73b86092.js"><link rel="prefetch" href="/assets/js/34.20b4a3b6.js"><link rel="prefetch" href="/assets/js/35.689bd95b.js"><link rel="prefetch" href="/assets/js/36.80e1fe7d.js"><link rel="prefetch" href="/assets/js/37.f7f3558b.js"><link rel="prefetch" href="/assets/js/38.6f9bf33e.js"><link rel="prefetch" href="/assets/js/39.8c5e668f.js"><link rel="prefetch" href="/assets/js/40.a7628ab4.js"><link rel="prefetch" href="/assets/js/41.a5b41e32.js"><link rel="prefetch" href="/assets/js/42.461779ff.js"><link rel="prefetch" href="/assets/js/43.7c5f369f.js"><link rel="prefetch" href="/assets/js/44.e8f30042.js"><link rel="prefetch" href="/assets/js/45.edfd6be7.js"><link rel="prefetch" href="/assets/js/46.a76797b7.js"><link rel="prefetch" href="/assets/js/47.f3b8a71b.js"><link rel="prefetch" href="/assets/js/48.ba939534.js"><link rel="prefetch" href="/assets/js/49.acf7ef52.js"><link rel="prefetch" href="/assets/js/51.9c664b1a.js"><link rel="prefetch" href="/assets/js/52.ffce015f.js"><link rel="prefetch" href="/assets/js/53.e2991248.js"><link rel="prefetch" href="/assets/js/54.b605d7cd.js"><link rel="prefetch" href="/assets/js/55.cefecc2f.js"><link rel="prefetch" href="/assets/js/56.bf2f2002.js"><link rel="prefetch" href="/assets/js/57.a37f970c.js"><link rel="prefetch" href="/assets/js/58.c08a6988.js"><link rel="prefetch" href="/assets/js/59.1a3d47cb.js"><link rel="prefetch" href="/assets/js/60.13824793.js"><link rel="prefetch" href="/assets/js/61.d396036e.js"><link rel="prefetch" href="/assets/js/62.ffd9c001.js"><link rel="prefetch" href="/assets/js/63.64096add.js"><link rel="prefetch" href="/assets/js/64.2973afe0.js"><link rel="prefetch" href="/assets/js/65.48bd20e6.js"><link rel="prefetch" href="/assets/js/66.882166fd.js"><link rel="prefetch" href="/assets/js/67.879297d8.js"><link rel="prefetch" href="/assets/js/68.302734b8.js"><link rel="prefetch" href="/assets/js/69.d18875e7.js"><link rel="prefetch" href="/assets/js/70.ee9a5aa2.js"><link rel="prefetch" href="/assets/js/71.6c440a5a.js"><link rel="prefetch" href="/assets/js/72.f9abc772.js"><link rel="prefetch" href="/assets/js/73.c93c2f02.js"><link rel="prefetch" href="/assets/js/74.7b645517.js"><link rel="prefetch" href="/assets/js/75.b0076022.js"><link rel="prefetch" href="/assets/js/76.dcc748a4.js"><link rel="prefetch" href="/assets/js/77.6a6ec985.js"><link rel="prefetch" href="/assets/js/78.d7cc8950.js"><link rel="prefetch" href="/assets/js/79.4bedc055.js">
    <link rel="stylesheet" href="/assets/css/0.styles.912ec5d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DMIT-2018 Student Notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/topics/" class="nav-link">Notes</a></div><div class="nav-item"><a href="/demos/" class="nav-link router-link-active">Demos</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="/exercises/" class="nav-link">Take Home</a></div><div class="nav-item"><a href="https://github.com/DMIT-2018/StudentNotes/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/topics/" class="nav-link">Notes</a></div><div class="nav-item"><a href="/demos/" class="nav-link router-link-active">Demos</a></div><div class="nav-item"><a href="/about/slides-installing-sql-server.html" class="nav-link">MS SQL 2017</a></div><div class="nav-item"><a href="/exercises/" class="nav-link">Take Home</a></div><div class="nav-item"><a href="https://github.com/DMIT-2018/StudentNotes/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/demos/eRestaurant/" class="sidebar-link">eRestaurant Demo</a></li><li><a href="/demos/eRestaurant/about/" class="sidebar-link">eRestaurant Background Story</a></li><li><a href="/demos/eRestaurant/dvcs/demo.html" class="sidebar-link">DVCS Demo</a></li><li><a href="/demos/eRestaurant/sitemaps/demo2.html" class="sidebar-link">Adding a Web.sitemap</a></li><li><a href="/demos/eRestaurant/linq/" class="sidebar-link">LINQ - Query and Method Syntax</a></li><li><a href="/demos/eRestaurant/linq/extensions.html" class="sidebar-link">LINQ - More Method Syntax</a></li><li><a href="/demos/eRestaurant/linq/practice.html" class="sidebar-link">Practice Linq</a></li><li><a href="/demos/eRestaurant/entityFramework/demo/demo.html" class="sidebar-link">Entity Framework Demo</a></li><li><a href="/demos/eRestaurant/entityFramework/practice/practice.html" class="sidebar-link">eRestuarant Practice</a></li><li><a href="/demos/eRestaurant/entityFramework/practice/practice-solution.html" class="sidebar-link">eRestuarant Practice - Solution</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/adminController.html" class="sidebar-link">Special Events - BLL</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/adminSpecialEvents.html" class="sidebar-link">Special Events - PL</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/menu.html" class="sidebar-link">Occupied Tables</a></li><li><a href="/demos/eRestaurant/reports/reportViewer/" class="sidebar-link">eRestaurant - Reporting Basics</a></li><li><a href="/demos/eRestaurant/reports/customizing/" class="sidebar-link">Customizing your Report</a></li><li><a href="/demos/eRestaurant/aspNet/userControls/messageUserControl.html" class="sidebar-link">MessageUserControl</a></li><li><a href="/demos/eRestaurant/testing/manual.html" class="sidebar-link">Faking a Point In Time</a></li><li><a href="/demos/eRestaurant/linq/frontDesk/reservations.html" class="sidebar-link">LinqPad - Querying Reservations</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/reservations.html" class="sidebar-link">Displaying Reservations</a></li><li><a href="/demos/eRestaurant/linq/frontDesk/occupiedTables.html" class="sidebar-link">LinqPad - Querying Occupied Tables</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/occupiedTables.html" class="sidebar-link">Occupied Tables</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/bootstrapStyle.html" class="sidebar-link">Styling the Front Desk</a></li><li><a href="/demos/eRestaurant/businessRules/businessRuleException.html" class="sidebar-link">Business Rule Violations</a></li><li><a href="/demos/eRestaurant/businessRules/frontDesk/seatingWalkIns.html" class="sidebar-link">Seating Walk-Ins</a></li><li><a href="/demos/eRestaurant/businessRules/frontDesk/seatingReservations.html" class="active sidebar-link">Seating Reservations</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/demos/eRestaurant/businessRules/frontDesk/seatingReservations.html#the-code…" class="sidebar-link">The Code…</a></li></ul></li><li><a href="/demos/eRestaurant/aspNet/userControls/fakeDateTime.html" class="sidebar-link">Fake DateTime</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/queryString.html" class="sidebar-link">Serving Tables</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="frontdesk-seating-reservations-listview-onitemcommand"><a href="#frontdesk-seating-reservations-listview-onitemcommand" aria-hidden="true" class="header-anchor">#</a> FrontDesk - Seating Reservations (ListView.OnItemCommand)</h1> <p>Seating Reservations is much like seating walk-in customers, except that the number of people in the reservation might be more than a single table can accommodate. Therefore, when the reservation party arrives, the host/hostess can choose which tables the party will be seated at, along with the waiter that will be the primary waiter serving the group and managing the bill. The business rules managed by the system are more complex than for seating walk-ins: A number of database tables will be affected by the seating of a reservation customer, and these must occur in a <strong>transaction</strong>, succeeding or failing as a group.</p> <ol><li>Tables must be available and the total capacity must accomodate the reservation party.</li> <li>A Bill is generated with an assigned waiter, and the bill is associated with the reservation</li> <li>The tables are associated with the reservation.</li> <li>The status of the reservation is to transition to Arrived.</li></ol> <h2 id="the-code…"><a href="#the-code…" aria-hidden="true" class="header-anchor">#</a> The Code…</h2> <ul><li>Create the BLL code to handle seating reservation customers. BLL code</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SeatCustomer</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> when<span class="token punctuation">,</span> <span class="token keyword">int</span> reservationId<span class="token punctuation">,</span> List<span class="token operator">&lt;</span><span class="token keyword">byte</span><span class="token operator">&gt;</span> tables<span class="token punctuation">,</span> <span class="token keyword">int</span> waiterId<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> availableSeats <span class="token operator">=</span> <span class="token function">AvailableSeatingByDateTime</span><span class="token punctuation">(</span>when<span class="token punctuation">.</span>Date<span class="token punctuation">,</span> when<span class="token punctuation">.</span>TimeOfDay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestaurantContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Rule checking:</span>
        <span class="token comment">// - Reservation must be in Booked status</span>
        <span class="token comment">// - Table must be available - typically a direct check on the table, but proxied based on the mocked time here</span>
        <span class="token comment">// - Table must be big enough for the # of customers</span>
        <span class="token keyword">var</span> reservation <span class="token operator">=</span> context<span class="token punctuation">.</span>Reservations<span class="token punctuation">.</span><span class="token function">Find</span><span class="token punctuation">(</span>reservationId<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>reservation <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
            errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;The specified reservation does not exist&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>reservation<span class="token punctuation">.</span>ReservationStatus <span class="token operator">!=</span> Reservation<span class="token punctuation">.</span>Booked<span class="token punctuation">)</span>
            errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;The reservation's status is not valid for seating. Only booked reservations can be seated.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> capacity <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token keyword">var</span> tableNumber <span class="token keyword">in</span> tables<span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableSeats<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>Table <span class="token operator">==</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">)</span>
                errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Table &quot;</span> <span class="token operator">+</span> tableNumber <span class="token operator">+</span> <span class="token string">&quot; is currently not available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">else</span>
                capacity <span class="token operator">+</span><span class="token operator">=</span> availableSeats<span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>Table <span class="token operator">==</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">.</span>Seating<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>capacity <span class="token operator">&lt;</span> reservation<span class="token punctuation">.</span>NumberInParty<span class="token punctuation">)</span>
            errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Insufficient seating capacity for number of customers. Alternate tables must be used.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessRuleException</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to seat customer&quot;</span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 1) Create a blank bill with assigned waiter</span>
        <span class="token class-name">Bill</span> seatedCustomer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            BillDate <span class="token operator">=</span> when<span class="token punctuation">,</span>
            NumberInParty <span class="token operator">=</span> reservation<span class="token punctuation">.</span>NumberInParty<span class="token punctuation">,</span>
            WaiterID <span class="token operator">=</span> waiterId<span class="token punctuation">,</span>
            ReservationID <span class="token operator">=</span> reservation<span class="token punctuation">.</span>ReservationID
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>Bills<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>seatedCustomer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 2) Add the tables for the reservation and change the reservation's status to arrived</span>
        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token keyword">var</span> tableNumber <span class="token keyword">in</span> tables<span class="token punctuation">)</span>
            reservation<span class="token punctuation">.</span>Tables<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Tables<span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>TableNumber <span class="token operator">==</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        reservation<span class="token punctuation">.</span>ReservationStatus <span class="token operator">=</span> Reservation<span class="token punctuation">.</span>Arrived<span class="token punctuation">;</span>
        <span class="token keyword">var</span> updatable <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">Entry</span><span class="token punctuation">(</span>context<span class="token punctuation">.</span>Reservations<span class="token punctuation">.</span><span class="token function">Attach</span><span class="token punctuation">(</span>reservation<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        updatable<span class="token punctuation">.</span><span class="token function">Property</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token operator">&gt;</span>x<span class="token punctuation">.</span>ReservationStatus<span class="token punctuation">)</span><span class="token punctuation">.</span>IsModified <span class="token operator">=</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
        <span class="token comment">//updatable.Reference(x=&gt;x.Tables).</span>
        <span class="token comment">// 3) Save changes</span>
        context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//string message = String.Format(&quot;Not yet implemented. Need to seat reservation {0} for waiter {1} at tables {2}&quot;, reservationId, waiterId, string.Join(&quot;, &quot;, tables));</span>
    <span class="token comment">//throw new NotImplementedException(message);</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Modify the ListView nested in the repeater to handle the OnItemCommand event. Website code - markup</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ListView</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ReservationSummaryListView<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">OnItemCommand</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ReservationSummaryListView_OnItemCommand<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">ItemType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eRestaurant.Entities.POCOs.ReservationSummary<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DataSource</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>&lt;%# Item.Reservations %&gt;<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>layouttemplate</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>seating<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>itemPlaceholder<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>layouttemplate</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>itemtemplate</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>
                &lt;%# Item.Name %&gt; —
                &lt;%# Item.NumberInParty %&gt; —
                &lt;%# Item.Status %&gt; —
                &lt;%# Item.Contact %&gt; —
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>LinkButton</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>InsertButton<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">CommandName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Seat<span class="token punctuation">&quot;</span></span> <span class="token attr-name">CommandArgument</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>&lt;%# Item.ID %&gt;<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>Reservation Seating<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>glyphicon glyphicon-plus<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>LinkButton</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>itemtemplate</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ListView</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Add a drop-down for the primary waiter and a multi-item select to identify the table(s) that the reservation party will be seated at. (code immediately after the Repeater/ListView for today's reservations)</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>Panel</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ReservationSeatingPanel<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Visible</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">'</span>&lt;%# ShowReservationSeating() %&gt;<span class="token punctuation">'</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>DropDownList</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WaiterDropDownList<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">CssClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>seating<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">AppendDataBoundItems</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>true<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DataSourceID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WaitersDataSource<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">DataTextField</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>FullName<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DataValueField</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WaiterId<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>listitem</span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>[select a waiter]<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>listitem</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>DropDownList</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ListBox</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ReservationTableListBox<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">CssClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>seating<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">DataSourceID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AvailableSeatingObjectDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">SelectionMode</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Multiple<span class="token punctuation">&quot;</span></span> <span class="token attr-name">Rows</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>14<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">DataTextField</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Table<span class="token punctuation">&quot;</span></span> <span class="token attr-name">DataValueField</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Table<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ListBox</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>Panel</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>As an exercise on your own, write the code for ShowReservationSeating() that will return true if the number of reservations for the day is greater than zero, false otherwise.</p> <div class="language-xml extra-class"><pre class="language-xml"><code>    &lt;%--For the Waiter DropDown--%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ObjectDataSource</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>WaitersDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">OldValuesParameterFormatString</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>original_{0}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">SelectMethod</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>ListAllWaiters<span class="token punctuation">&quot;</span></span> <span class="token attr-name">TypeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eRestaurant.BLL.RestaurantAdminController<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ObjectDataSource</span><span class="token punctuation">&gt;</span></span>
    
    &lt;%--For the Available Tables DropDown (seating reservation)--%&gt;
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>ObjectDataSource</span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AvailableSeatingObjectDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">OldValuesParameterFormatString</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>original_{0}<span class="token punctuation">&quot;</span></span> <span class="token attr-name">SelectMethod</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>AvailableSeatingByDateTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">TypeName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eRestaurant.BLL.SeatingController<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>selectparameters</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>controlparameter</span> <span class="token attr-name">ControlID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SearchDate<span class="token punctuation">&quot;</span></span> <span class="token attr-name">PropertyName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>date<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>DateTime<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>controlparameter</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>controlparameter</span> <span class="token attr-name">ControlID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SearchTime<span class="token punctuation">&quot;</span></span> <span class="token attr-name">PropertyName</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">dbtype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>Time<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>time<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>controlparameter</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>selectparameters</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">asp:</span>ObjectDataSource</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Write the code to handle the OnItemCommand event.</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">ReservationSummaryListView_OnItemCommand</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">ListViewCommandEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Check the command name and add the reservation for the specified seats.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span>CommandName<span class="token punctuation">.</span><span class="token function">Equals</span><span class="token punctuation">(</span><span class="token string">&quot;Seat&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        MessageUserControl<span class="token punctuation">.</span><span class="token function">TryRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
        <span class="token punctuation">{</span>
            <span class="token comment">// Get the data</span>
            <span class="token keyword">var</span> reservationId <span class="token operator">=</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>CommandArgument<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">var</span> selectedItems <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">byte</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token class-name">ListItem</span> item <span class="token keyword">in</span> ReservationTableListBox<span class="token punctuation">.</span>Items<span class="token punctuation">)</span>
            <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>Selected<span class="token punctuation">)</span>
                    selectedItems<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>item<span class="token punctuation">.</span>Text<span class="token punctuation">.</span><span class="token function">Replace</span><span class="token punctuation">(</span><span class="token string">&quot;Table &quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">var</span> when <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>SearchDate<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>SearchTime<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Seat the reservation customer</span>
            <span class="token keyword">var</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeatingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            controller<span class="token punctuation">.</span><span class="token function">SeatCustomer</span><span class="token punctuation">(</span>when<span class="token punctuation">,</span> reservationId<span class="token punctuation">,</span> selectedItems<span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>WaiterDropDownList<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// Refresh the gridview</span>
            SeatingGridView<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            ReservationsRepeater<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Customer Seated&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Reservation customer has arrived and has been seated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code>    <span class="token keyword">protected</span> <span class="token keyword">bool</span> <span class="token function">ShowReservationSeating</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// TODO: Get the reservations for the day and return true if there are reservations, false otherwise</span>
        <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">7/4/2018, 4:01:50 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/demos/eRestaurant/businessRules/frontDesk/seatingWalkIns.html" class="prev">
          Seating Walk-Ins
        </a></span> <span class="next"><a href="/demos/eRestaurant/aspNet/userControls/fakeDateTime.html">
          Fake DateTime
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/50.d0852263.js" defer></script><script src="/assets/js/app.df72257b.js" defer></script>
  </body>
</html>
