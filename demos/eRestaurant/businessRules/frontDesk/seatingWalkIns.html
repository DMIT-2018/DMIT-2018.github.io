<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Seating Walk-Ins | DMIT-2018 Student Notes</title>
    <meta name="description" content="Intermediate Application Development">
    
    
    <link rel="preload" href="/assets/css/0.styles.912ec5d4.css" as="style"><link rel="preload" href="/assets/js/app.51c3cf1d.js" as="script"><link rel="preload" href="/assets/js/57.ebfb5aec.js" as="script"><link rel="prefetch" href="/assets/js/1.4037ccf8.js"><link rel="prefetch" href="/assets/js/2.9bb2b853.js"><link rel="prefetch" href="/assets/js/3.07b50e15.js"><link rel="prefetch" href="/assets/js/4.e9aa1d15.js"><link rel="prefetch" href="/assets/js/5.e97bf9a5.js"><link rel="prefetch" href="/assets/js/6.348a5c05.js"><link rel="prefetch" href="/assets/js/7.16dadbb4.js"><link rel="prefetch" href="/assets/js/8.9b1a883c.js"><link rel="prefetch" href="/assets/js/9.89ead73c.js"><link rel="prefetch" href="/assets/js/10.c13a0153.js"><link rel="prefetch" href="/assets/js/11.88805ebb.js"><link rel="prefetch" href="/assets/js/12.73173c9d.js"><link rel="prefetch" href="/assets/js/13.72cdd9de.js"><link rel="prefetch" href="/assets/js/14.53fa892f.js"><link rel="prefetch" href="/assets/js/15.f8948783.js"><link rel="prefetch" href="/assets/js/16.452f8a8d.js"><link rel="prefetch" href="/assets/js/17.2a68f05b.js"><link rel="prefetch" href="/assets/js/18.abde29df.js"><link rel="prefetch" href="/assets/js/19.a21714c2.js"><link rel="prefetch" href="/assets/js/20.dcb27f2b.js"><link rel="prefetch" href="/assets/js/21.78092f61.js"><link rel="prefetch" href="/assets/js/22.13d4a2e3.js"><link rel="prefetch" href="/assets/js/23.6131251d.js"><link rel="prefetch" href="/assets/js/24.c1bada5a.js"><link rel="prefetch" href="/assets/js/25.28d67d6d.js"><link rel="prefetch" href="/assets/js/26.c630cab0.js"><link rel="prefetch" href="/assets/js/27.a0275a1f.js"><link rel="prefetch" href="/assets/js/28.38a7bc8b.js"><link rel="prefetch" href="/assets/js/29.e5604467.js"><link rel="prefetch" href="/assets/js/30.b13b10a2.js"><link rel="prefetch" href="/assets/js/31.b93fbde4.js"><link rel="prefetch" href="/assets/js/32.7439fa34.js"><link rel="prefetch" href="/assets/js/33.5b4f7569.js"><link rel="prefetch" href="/assets/js/34.5c950f18.js"><link rel="prefetch" href="/assets/js/35.205ec25c.js"><link rel="prefetch" href="/assets/js/36.f9d2b2d8.js"><link rel="prefetch" href="/assets/js/37.607240a2.js"><link rel="prefetch" href="/assets/js/38.cd354db5.js"><link rel="prefetch" href="/assets/js/39.c79c3f2b.js"><link rel="prefetch" href="/assets/js/40.5c50d587.js"><link rel="prefetch" href="/assets/js/41.e8da87d1.js"><link rel="prefetch" href="/assets/js/42.cfcc98ee.js"><link rel="prefetch" href="/assets/js/43.2bfccf8b.js"><link rel="prefetch" href="/assets/js/44.256f20a9.js"><link rel="prefetch" href="/assets/js/45.046060f0.js"><link rel="prefetch" href="/assets/js/46.41478319.js"><link rel="prefetch" href="/assets/js/47.0fb1ab9a.js"><link rel="prefetch" href="/assets/js/48.eea5db49.js"><link rel="prefetch" href="/assets/js/49.0137d27b.js"><link rel="prefetch" href="/assets/js/50.7c1751fe.js"><link rel="prefetch" href="/assets/js/51.ef65524b.js"><link rel="prefetch" href="/assets/js/52.a7a3a45b.js"><link rel="prefetch" href="/assets/js/53.3820eaa9.js"><link rel="prefetch" href="/assets/js/54.70d4aeeb.js"><link rel="prefetch" href="/assets/js/55.f9cacc3a.js"><link rel="prefetch" href="/assets/js/56.0fc0a19c.js"><link rel="prefetch" href="/assets/js/58.e3d33a0c.js"><link rel="prefetch" href="/assets/js/59.4d5b9bbc.js"><link rel="prefetch" href="/assets/js/60.513d408e.js"><link rel="prefetch" href="/assets/js/61.f5e078b4.js"><link rel="prefetch" href="/assets/js/62.15457f34.js"><link rel="prefetch" href="/assets/js/63.1f1f155f.js"><link rel="prefetch" href="/assets/js/64.27d6719a.js"><link rel="prefetch" href="/assets/js/65.feb2db61.js"><link rel="prefetch" href="/assets/js/66.24667d3b.js"><link rel="prefetch" href="/assets/js/67.88417ef2.js"><link rel="prefetch" href="/assets/js/68.64cd3bce.js"><link rel="prefetch" href="/assets/js/69.453ac1d5.js"><link rel="prefetch" href="/assets/js/70.4efd5f70.js"><link rel="prefetch" href="/assets/js/71.65ae3dd0.js"><link rel="prefetch" href="/assets/js/72.eded1e00.js"><link rel="prefetch" href="/assets/js/73.a044f661.js"><link rel="prefetch" href="/assets/js/74.79a2f116.js"><link rel="prefetch" href="/assets/js/75.e52a8154.js"><link rel="prefetch" href="/assets/js/76.68ba8eac.js"><link rel="prefetch" href="/assets/js/77.6274b0c6.js"><link rel="prefetch" href="/assets/js/78.0d907db6.js"><link rel="prefetch" href="/assets/js/79.25fadaa4.js"><link rel="prefetch" href="/assets/js/80.7592f6cf.js"><link rel="prefetch" href="/assets/js/81.b24d9371.js"><link rel="prefetch" href="/assets/js/82.74f4393a.js"><link rel="prefetch" href="/assets/js/83.5c1fba71.js"><link rel="prefetch" href="/assets/js/84.f8f958b2.js"><link rel="prefetch" href="/assets/js/85.a35f50f6.js"><link rel="prefetch" href="/assets/js/86.e411ad2b.js"><link rel="prefetch" href="/assets/js/87.b508658d.js"><link rel="prefetch" href="/assets/js/88.ac685d7a.js"><link rel="prefetch" href="/assets/js/89.8503e662.js">
    <link rel="stylesheet" href="/assets/css/0.styles.912ec5d4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">DMIT-2018 Student Notes</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/topics/" class="nav-link">Notes</a></div><div class="nav-item"><a href="/demos/" class="nav-link router-link-active">Demos</a></div><div class="nav-item"><a href="https://dmit-2018.github.io/about/slides-installing-sql-server.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MS SQL 2017
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/exercises/" class="nav-link">Take Home</a></div><div class="nav-item"><a href="https://github.com/DMIT-2018/StudentNotes/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/about/" class="nav-link">About</a></div><div class="nav-item"><a href="/topics/" class="nav-link">Notes</a></div><div class="nav-item"><a href="/demos/" class="nav-link router-link-active">Demos</a></div><div class="nav-item"><a href="https://dmit-2018.github.io/about/slides-installing-sql-server.html" target="_blank" rel="noopener noreferrer" class="nav-link external">
  MS SQL 2017
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/exercises/" class="nav-link">Take Home</a></div><div class="nav-item"><a href="https://github.com/DMIT-2018/StudentNotes/issues/new" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Issues/Bugs
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="https://moodle.nait.ca" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Moodle
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/demos/eRestaurant/" class="sidebar-link">eRestaurant Demo</a></li><li><a href="/demos/eRestaurant/about/" class="sidebar-link">eRestaurant Background Story</a></li><li><a href="/demos/eRestaurant/dvcs/demo.html" class="sidebar-link">DVCS Demo</a></li><li><a href="/demos/eRestaurant/sitemaps/demo2.html" class="sidebar-link">Adding a Web.sitemap</a></li><li><a href="/demos/eRestaurant/linq/" class="sidebar-link">LINQ - Query and Method Syntax</a></li><li><a href="/demos/eRestaurant/linq/extensions.html" class="sidebar-link">LINQ - More Method Syntax</a></li><li><a href="/demos/eRestaurant/linq/practice.html" class="sidebar-link">Practice Linq</a></li><li><a href="/demos/eRestaurant/entityFramework/demo/demo.html" class="sidebar-link">Entity Framework Demo</a></li><li><a href="/demos/eRestaurant/entityFramework/practice/practice.html" class="sidebar-link">eRestuarant Practice</a></li><li><a href="/demos/eRestaurant/entityFramework/practice/practice-solution.html" class="sidebar-link">eRestuarant Practice - Solution</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/adminController.html" class="sidebar-link">Special Events - BLL</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/adminSpecialEvents.html" class="sidebar-link">Special Events - PL</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/menu.html" class="sidebar-link">Occupied Tables</a></li><li><a href="/demos/eRestaurant/reports/reportViewer/" class="sidebar-link">eRestaurant - Reporting Basics</a></li><li><a href="/demos/eRestaurant/reports/customizing/" class="sidebar-link">Customizing your Report</a></li><li><a href="/demos/eRestaurant/aspNet/userControls/messageUserControl.html" class="sidebar-link">MessageUserControl</a></li><li><a href="/demos/eRestaurant/testing/manual.html" class="sidebar-link">Faking a Point In Time</a></li><li><a href="/demos/eRestaurant/linq/frontDesk/reservations.html" class="sidebar-link">LinqPad - Querying Reservations</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/reservations.html" class="sidebar-link">Displaying Reservations</a></li><li><a href="/demos/eRestaurant/linq/frontDesk/occupiedTables.html" class="sidebar-link">LinqPad - Querying Occupied Tables</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/occupiedTables.html" class="sidebar-link">Occupied Tables</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/bootstrapStyle.html" class="sidebar-link">Styling the Front Desk</a></li><li><a href="/demos/eRestaurant/businessRules/businessRuleException.html" class="sidebar-link">Business Rule Violations</a></li><li><a href="/demos/eRestaurant/businessRules/frontDesk/seatingWalkIns.html" class="active sidebar-link">Seating Walk-Ins</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/demos/eRestaurant/businessRules/frontDesk/seatingWalkIns.html#the-code…" class="sidebar-link">The Code…</a></li></ul></li><li><a href="/demos/eRestaurant/businessRules/frontDesk/seatingReservations.html" class="sidebar-link">Seating Reservations</a></li><li><a href="/demos/eRestaurant/aspNet/userControls/fakeDateTime.html" class="sidebar-link">Fake DateTime</a></li><li><a href="/demos/eRestaurant/aspNet/frontDesk/queryString.html" class="sidebar-link">Serving Tables</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="frontdesk-seating-walk-in-customers-gridview-selectedindexchanging"><a href="#frontdesk-seating-walk-in-customers-gridview-selectedindexchanging" aria-hidden="true" class="header-anchor">#</a> FrontDesk - Seating Walk-In Customers (GridView.SelectedIndexChanging)</h1> <p>A key aspect of the Front Desk is to seat walk-in customers at available tables. For the host, this should be easy: Simply choose an available table, identify the number of people and the waiter, and click the link to seat the customers. In the system, however, the process of seating customers must follow the workflow of the business:</p> <ol><li>Ensure the table is truly available and has the capacity for the number of customers.</li> <li>Create a bill and assign the waiter and table.</li></ol> <p>It is worthwhile to note that in workflow for this restaurant, a Bill must be associated with either a single Table or with a Reservation, but not both. Also, the bill is created at the point in time that the customer is seated, with a waiter assigned to the table. The thought process behind this workflow is that the waiter can be notified that there is a new customer, and will be able to see when they were seated and how long they have been waiting to be served.</p> <p>At present, this is the limit to the complexity of handling billing of customers in this restaurant; more realistic scenarios could easily have more complex bill processing, such as allowing people at the table to split a bill or multiple tables to combine a bill, or reservations to split their bills, etc.</p> <h2 id="the-code…"><a href="#the-code…" aria-hidden="true" class="header-anchor">#</a> The Code…</h2> <ul><li>Create the BLL code to handle seating walk-in customers. BLL code</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token punctuation">[</span><span class="token class-name">DataObjectMethod</span><span class="token punctuation">(</span>DataObjectMethodType<span class="token punctuation">.</span>Select<span class="token punctuation">)</span><span class="token punctuation">]</span>
<span class="token keyword">public</span> List<span class="token operator">&lt;</span>seatingsummary<span class="token operator">&gt;</span> <span class="token function">AvailableSeatingByDateTime</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> date<span class="token punctuation">,</span> <span class="token class-name">TimeSpan</span> time<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> result <span class="token operator">=</span> <span class="token keyword">from</span> seats <span class="token keyword">in</span> <span class="token function">SeatingByDateTime</span><span class="token punctuation">(</span>date<span class="token punctuation">,</span> time<span class="token punctuation">)</span>
                    <span class="token keyword">where</span> <span class="token operator">!</span>seats<span class="token punctuation">.</span><span class="token class-name">Taken</span>
                    <span class="token keyword">select</span> seats<span class="token punctuation">;</span>
    <span class="token keyword">return</span> result<span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Seats a customer that is a walk-in</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name=&quot;when&quot;&gt;A mock value of the date/time (Temporary - see remarks)&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name=&quot;tableNumber&quot;&gt;Table number to be seated&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name=&quot;customerCount&quot;&gt;Number of customers being seated&lt;/param&gt;</span>
<span class="token comment">/// &lt;param name=&quot;waiterId&quot;&gt;Id of waiter that is serving&lt;/param&gt;</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">SeatCustomer</span><span class="token punctuation">(</span><span class="token class-name">DateTime</span> when<span class="token punctuation">,</span> <span class="token keyword">byte</span> tableNumber<span class="token punctuation">,</span> <span class="token keyword">int</span> customerCount<span class="token punctuation">,</span> <span class="token keyword">int</span> waiterId<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> availableSeats <span class="token operator">=</span> <span class="token function">AvailableSeatingByDateTime</span><span class="token punctuation">(</span>when<span class="token punctuation">.</span>Date<span class="token punctuation">,</span> when<span class="token punctuation">.</span>TimeOfDay<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">using</span> <span class="token punctuation">(</span><span class="token keyword">var</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">RestaurantContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        List<span class="token operator">&lt;</span><span class="token keyword">string</span><span class="token operator">&gt;</span> errors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token generic-method"><span class="token function">List</span><span class="token punctuation">&lt;</span><span class="token keyword">string</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Rule checking:</span>
        <span class="token comment">// - Table must be available - typically a direct check on the table, but proxied based on the mocked time here</span>
        <span class="token comment">// - Table must be big enough for the # of customers</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableSeats<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>Table <span class="token operator">==</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">)</span>
            errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Table is currently not available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>availableSeats<span class="token punctuation">.</span><span class="token function">Exists</span><span class="token punctuation">(</span>x <span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>Table <span class="token operator">==</span> tableNumber <span class="token operator">&amp;&amp;</span> x<span class="token punctuation">.</span>Seating <span class="token operator">&gt;=</span> customerCount<span class="token punctuation">)</span><span class="token punctuation">)</span>
            errors<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token string">&quot;Insufficient seating capacity for number of customers.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>errors<span class="token punctuation">.</span>Count <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">BusinessRuleException</span><span class="token punctuation">(</span><span class="token string">&quot;Unable to seat customer&quot;</span><span class="token punctuation">,</span> errors<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Bill</span> seatedCustomer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bill</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            BillDate <span class="token operator">=</span> when<span class="token punctuation">,</span>
            NumberInParty <span class="token operator">=</span> customerCount<span class="token punctuation">,</span>
            WaiterID <span class="token operator">=</span> waiterId<span class="token punctuation">,</span>
            TableID <span class="token operator">=</span> context<span class="token punctuation">.</span>Tables<span class="token punctuation">.</span><span class="token function">Single</span><span class="token punctuation">(</span>x<span class="token operator">=</span><span class="token operator">&gt;</span> x<span class="token punctuation">.</span>TableNumber <span class="token operator">==</span> tableNumber<span class="token punctuation">)</span><span class="token punctuation">.</span>TableID
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span>Bills<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>seatedCustomer<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">SaveChanges</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><ul><li>Modify the GridView to handle the OnSelectedIndexChanging event.</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">asp:</span>GridView</span> <span class="token attr-name">ID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SeatingGridView<span class="token punctuation">&quot;</span></span> <span class="token attr-name">runat</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>server<span class="token punctuation">&quot;</span></span> <span class="token attr-name">AutoGenerateColumns</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>False<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">CssClass</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>table table-hover table-striped table-condensed<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">OnSelectedIndexChanging</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SeatingGridView_SelectedIndexChanging<span class="token punctuation">&quot;</span></span>
    <span class="token attr-name">DataSourceID</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>SeatingObjectDataSource<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ItemType</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>eRestaurant.Entities.DTOs.SeatingSummary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Write the code to handle the OnSelectedIndexChanging event.</li></ul> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">SeatingGridView_SelectedIndexChanging</span><span class="token punctuation">(</span><span class="token keyword">object</span> sender<span class="token punctuation">,</span> <span class="token class-name">GridViewSelectEventArgs</span> e<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Seat walk-in customers</span>
    MessageUserControl<span class="token punctuation">.</span><span class="token function">TryRun</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span>
    <span class="token punctuation">{</span>
        <span class="token comment">// TODO: There are a lot of assumptions in parsing the input, and it would be better</span>
        <span class="token comment">//       to break this into chunks an display appropriate &quot;usage&quot; messages to the end-user.</span>
        <span class="token comment">// Get the controls</span>
        <span class="token class-name">GridViewRow</span> row <span class="token operator">=</span> SeatingGridView<span class="token punctuation">.</span>Rows<span class="token punctuation">[</span>e<span class="token punctuation">.</span>NewSelectedIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> tableControl <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;TableNumber&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> Label<span class="token punctuation">;</span>
        <span class="token keyword">var</span> numberInPartyControl <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;NumberInParty&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> TextBox<span class="token punctuation">;</span>
        <span class="token keyword">var</span> waiterListControl <span class="token operator">=</span> row<span class="token punctuation">.</span><span class="token function">FindControl</span><span class="token punctuation">(</span><span class="token string">&quot;WaiterList&quot;</span><span class="token punctuation">)</span> <span class="token keyword">as</span> DropDownList<span class="token punctuation">;</span>
        <span class="token keyword">var</span> when <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>SearchDate<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>TimeSpan<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>SearchTime<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Seat the customer</span>
        <span class="token keyword">var</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SeatingController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        controller<span class="token punctuation">.</span><span class="token function">SeatCustomer</span><span class="token punctuation">(</span>when<span class="token punctuation">,</span> <span class="token keyword">byte</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>tableControl<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>numberInPartyControl<span class="token punctuation">.</span>Text<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">int</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span>waiterListControl<span class="token punctuation">.</span>SelectedValue<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// Refresh the gridview</span>
        SeatingGridView<span class="token punctuation">.</span><span class="token function">DataBind</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token string">&quot;Customer Seated&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;New walk-in customer has been seated&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><hr> <blockquote><p>Extra! Extra! Modifying the MessageUserControl.ascx to handle Business Rule Exceptions</p></blockquote> <p>TBA</p> <div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Processes a request through a callback delegate within a try/catch block. Distinguished Entity Framework exceptions from general exceptions.</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name=&quot;callback&quot;&gt;A delegate method to call within the try block&lt;/param&gt;</span>
<span class="token comment">/// &lt;returns&gt;True if the callback was successful (did not generate an exception); false otherwise&lt;/returns&gt;</span>
<span class="token keyword">private</span> <span class="token keyword">bool</span> <span class="token function">TryCatch</span><span class="token punctuation">(</span><span class="token class-name">ProcessRequest</span> callback<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">try</span>
    <span class="token punctuation">{</span>
        <span class="token function">callback</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token keyword">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">BusinessRuleException</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">HandleException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">DbEntityValidationException</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">HandleException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> ex<span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token function">HandleException</span><span class="token punctuation">(</span>ex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token keyword">false</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><div class="language-csharp extra-class"><pre class="language-csharp"><code><span class="token comment">/// &lt;summary&gt;</span>
<span class="token comment">/// Handles a customer BusinessRuleExceptoin by displaying the details and the general error.</span>
<span class="token comment">/// &lt;/summary&gt;</span>
<span class="token comment">/// &lt;param name=&quot;ex&quot;&gt;&lt;/param&gt;</span>
<span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">HandleException</span><span class="token punctuation">(</span><span class="token class-name">BusinessRuleException</span> ex<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token keyword">var</span> details <span class="token operator">=</span> <span class="token keyword">from</span> detail <span class="token keyword">in</span> ex<span class="token punctuation">.</span><span class="token class-name">RuleDetails</span>
                    <span class="token keyword">select</span> <span class="token keyword">new</span>
                    <span class="token punctuation">{</span>
                        Error <span class="token operator">=</span> detail
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token function">ShowExceptions</span><span class="token punctuation">(</span>details<span class="token punctuation">,</span> ex<span class="token punctuation">.</span>Message<span class="token punctuation">,</span> STR_TITLE_ValidationErrors<span class="token punctuation">,</span> STR_TITLE_ICON_warning<span class="token punctuation">,</span> STR_PANEL_danger<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div></div> <div class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">10/22/2018, 6:06:13 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/demos/eRestaurant/businessRules/businessRuleException.html" class="prev">
          Business Rule Violations
        </a></span> <span class="next"><a href="/demos/eRestaurant/businessRules/frontDesk/seatingReservations.html">
          Seating Reservations
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/57.ebfb5aec.js" defer></script><script src="/assets/js/app.51c3cf1d.js" defer></script>
  </body>
</html>
